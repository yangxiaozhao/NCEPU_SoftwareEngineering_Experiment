DATAS SEGMENT

TELEPHONE STRUCT            
      TNAME  DB 20 DUP('$')    
      NUMBER DB 11 DUP('$')   
TELEPHONE ENDS
      MENU0 DB 'TELEPHONEBOOK:$'    ; 以下均为提示语
      MENU1 DB '1.ADD TELEPHONE$'
      MENU2 DB '2.SHOW TELEPHONE$'
      MENU3 DB '3.SEARCH TELEBOOK$'
      MENU4 DB '4.EXIT$'
      MENU5 DB 'PLEASE INPUT (1 TO 4): $'
      
      ERROR DB 'ERROR! PLEASE INPUT AGAIN!'
      
      OP1_1 DB 'INPUT THE NAME: $'
      OP1_2 DB 'INPUT THE NUMBER: $' 
      
      OP2_1 DB 'NAME: $'
      OP2_2 DB 'TELEPHONE: $'
      OP2_3 DB '---------------------------$'
      
      OP3_1 DB 'INPUT THE SEARCH-NAME: $'
      OP3_2 DB 'NO MATCH!$'
      OP3_3 DB 'MATCH!$'
      OP3_N DB  20 DUP('$')
      
      OP4_1 DB 'THANKS FOR YOUR USING!$'
      OP4_2 DB '***************************$'
      
      TELEBOOK TELEPHONE 20 DUP(<>)		
DATAS ENDS

STACKS SEGMENT
    ;此处输入堆栈段代码
STACKS ENDS

CODES SEGMENT
    ASSUME CS:CODES,DS:DATAS,SS:STACKS
START:
    MOV AX,DATAS
    MOV DS,AX
    MOV SI,0
    MOV CX,0

MENU:              ; 显示主菜单
	LEA DX,MENU0
	MOV AH,09H
	INT 21H
	CALL NEWLINE
	LEA DX,MENU1
	INT 21H
	CALL NEWLINE
	LEA DX,MENU2
	INT 21H
	CALL NEWLINE
	LEA DX,MENU3
	INT 21H
	CALL NEWLINE
	LEA DX,MENU4
	INT 21H
	CALL NEWLINE
	LEA DX,MENU5
	INT 21H
	
CHOICE:            ; 选择相应的功能
	MOV AH,01H
	INT 21H
	CMP AL,'1'
	JE ADDNUM
	CMP AL,'2'
	JE SHOWNUM
	CMP AL,'3'
	JE SEARCH
	CMP AL,'4'
	JE EXIT
	CALL NEWLINE
	LEA DX,ERROR
	MOV AH,09H
	INT 21H
	CALL NEWLINE
	CALL NEWLINE
	JMP MENU
	 
ADDNUM:           ; 添加联系人
	CALL NEWLINE
	LEA DX,OP1_1
	MOV AH,09H
	INT 21H
	LEA DX,TELEBOOK[SI].TNAME     ; 输入联系人姓名
	MOV AH,0AH
	INT 21H
	CALL NEWLINE
	LEA DX,OP1_2
	MOV AH,09H
	INT 21H
	LEA DX,TELEBOOK[SI].NUMBER		; 输入联系人号码
	MOV AH,0AH
	INT 21H
	ADD SI,31
	INC CX
	CALL NEWLINE
	CALL NEWLINE
	JMP MENU

SHOWNUM:			; 显示通讯录所有联系人
    MOV DI,0
    CALL NEWLINE 
    MOV AH,09H
    LEA DX,OP2_3
    INT 21H
SHOW:
	MOV AL,TELEBOOK[DI].TNAME+2
    CMP AL,'$'
    CALL NEWLINE 
    JE MENU
    MOV AH,09H
    LEA DX,OP2_1
    INT 21H
    LEA DX,TELEBOOK[DI].TNAME+2
    INT 21H
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP2_2
    INT 21H
    LEA DX,TELEBOOK[DI].NUMBER+2
    INT 21H 
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP2_3
    INT 21H
    ADD DI,31
    JMP SHOW
	
	
SEARCH:					; 查找联系人
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP3_1
    INT 21H
    MOV AH,0AH
    LEA DX,OP3_N
    INT 21H  		  ;输入查找的名字
    MOV DI,0
    PUSH SI
LOOP1:
    MOV AL,TELEBOOK[DI].TNAME+2
    CMP AL,'$'
    JE NOMATCH 
    MOV SI,0
    MOV CL,0  		; 记录本次匹配的次数
LOOP2:
    MOV AL,OP3_N[SI+2]
    CMP AL,TELEBOOK[DI].TNAME+2
    JNE NOTEQUAL
    INC DI
    INC SI
    INC CL
    CMP CL,OP3_N+1
    JE MATCH		; 匹配次数与姓名长度相同，则匹配成功
    JMP LOOP2
NOTEQUAL:
    MOV CH,0
    SUB DI,CX
    ADD DI,31
    JMP LOOP1
MATCH:
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP3_3
    INT 21H
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP2_1
    INT 21H
    LEA DX,OP3_N+2
    INT 21H
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP2_2
    INT 21H
    XOR CH,CH
    SUB DI,CX
    LEA DX,TELEBOOK[DI].NUMBER+2
    INT 21H
    CALL NEWLINE
    CALL NEWLINE
    POP SI
    JMP MENU
NOMATCH:
    CALL NEWLINE
    MOV AH,09H
    LEA DX,OP3_2
    INT 21H
    CALL NEWLINE
    CALL NEWLINE
    POP SI
    JMP MENU

EXIT:					; 退出通讯录
	CALL NEWLINE
	LEA DX,OP4_1
	MOV AH,09H
	INT 21H
	CALL NEWLINE
	LEA DX,OP4_2
	INT 21H
	MOV AH,4CH
	INT 21H

		
NEWLINE:                 ; 子程序（回车换行）
	PUSH AX
    MOV AH,02H
    MOV DL,0DH
    INT 21H
    MOV DL,0AH
    INT 21H
    POP AX
    RET

CODES ENDS
    END START










